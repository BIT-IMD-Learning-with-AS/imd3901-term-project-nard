<!DOCTYPE html>
<html>
    <head>
      <meta name="description" content="NARD's Alpha Prototype!">
      
      <script src="/js/aframe.min.js"></script>
      <script src="js/aframe-environment-component.min.js"></script>
      <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
      <script src="https://unpkg.com/super-hands@^2.1.0/dist/super-hands.min.js"></script>
      <script src="https://mixedreality.mozilla.org/ammo.js/builds/ammo.wasm.js"></script>
      <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>

      <link rel="stylesheet" href="/css/user-gesture.css">

      <script>
        // Registering a-scene
        AFRAME.registerComponent('precontact-experience', {
          init: function () {
            console.log('scene loaded');
            artifactFound = false;
            document.querySelector('#user-gesture-overlay3').style.display='none';
            document.querySelector('#user-gesture-button3').style.display='none';
          }
        });
        
        // Button = Sends to diff html file
        const precontactExperience = function() {
              //hide user-gesture overlay
              document.querySelector('#user-gesture-overlay3').style.display='none';
              window.location.replace("http://localhost:8080/returnJourney.html");
        }

        var artifactFound;

        // CLICK EVENTS
        const onClick = (event) => {
          // Finding artifact
          if(event.srcElement.id == "artifact"){
            console.log("ARTIFACT FOUND")
            artifactFound = true;
            event.srcElement.parentElement.removeChild(event.srcElement);
            var element = document.getElementById('collectedItem');
            element.style.opacity = "0.9";
            element.style.filter  = 'alpha(opacity=90)'; 
          }
          // Returning artifact
          if(event.srcElement.id == "rightfulPlace"){
            console.log("ARTIFACT RETURNED " + artifactFound);
            if(artifactFound){
            var element = document.getElementById('collectedItem');
            element.style.opacity = "0";
            element.style.filter  = 'alpha(opacity=0)'; 
            document.querySelector('#user-gesture-overlay3').style.display='block';
            document.querySelector('#user-gesture-button3').style.display='block';
            }
            else{
              console.log("Bring me what I lost")
            }
          }
        } 
        window.addEventListener('click', onClick);
      </script>

    </head>
    <body>

      <!-- BUTTON EXPERIENCE -->
      <div id="collectedItem" style="position:absolute; bottom:0px; left:1vw; z-index:1000; opacity: 0;">
        <img src="assets/box.png" width="150" height="150">
      </div>

      <div id="user-gesture-overlay3">
        <div class="center">
          <button id="user-gesture-button3" onclick="precontactExperience();">Continue Journey</button>
        </div>
      </div>

      <!-- A-SCENE -->
      <a-scene precontact-experience environment="preset: forest; shadow: true" physics="driver:ammo;">
     
      <a-assets>
      </a-assets>

      <!-- river -->
      <a-plane height="100" width="200" position="0 0.3 50" rotation="-90 0 0" material="color:lightblue"></a-plane>

      <!-- artifact and rightful place -->
      <a-box id="artifact" ammo-body="type:kinematic; emitCollisionEvents: true" ammo-shape="type:box" scale="0.5 0.5 0.5" position="0 0.2 -10" material="color:black"></a-box>
      <a-box id="rightfulPlace" ammo-body="type:kinematic; emitCollisionEvents: true" ammo-shape="type:box" scale="0.5 5 0.5" position="10 0.5 -5" material="color:#654321"></a-box>

      <!-- canoe -->
      <a-box boat id="canoe" ammo-body="type:kinematic; emitCollisionEvents: true" ammo-shape="type:box"  position="0 0.2 0" scale="1 1 3" material="color:brown"> </a-box>
      
      <!-- DO NOT TOUCH camera or cursor -->
      <a-entity progressive-controls></a-entity>
      <a-camera >
        <a-entity cursor position="0 0 -1"
                  geometry="primitive: sphere; radius:0.008"
                  material="color:black; shader:flat; opacity:0.5"></a-entity>
      </a-camera>

    </a-scene>
  </body>
</html>