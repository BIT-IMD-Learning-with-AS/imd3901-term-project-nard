<!DOCTYPE html>
<html>
    <head>
      <meta name="description" content="NARD's Alpha Prototype!">
      
      <!-- DO NOT TOUCH -->
      <script src="/js/aframe.min.js"></script>
      <script src="js/aframe-environment-component.min.js"></script>
      <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
      <script src="https://unpkg.com/super-hands@^2.1.0/dist/super-hands.min.js"></script>
      <script src="https://mixedreality.mozilla.org/ammo.js/builds/ammo.wasm.js"></script>
      <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>

      <script src="/objInteraction.js"></script>
      <!-- DO NOT TOUCH -->

      <link rel="stylesheet" href="/css/user-gesture.css">

      <script>
        // Registering a-scene
        AFRAME.registerComponent('precontact-experience', {
          init: function () {
            console.log('scene loaded');

            // Fade out
            var player = document.getElementById("player");
            let blocker = document.createElement('a-sphere');
            blocker.setAttribute('radius', '0.05');
            blocker.setAttribute('material', "shader:flat; color: white; opacity: 1.0; side: double");
            blocker.setAttribute('id', "artifact");
            blocker.setAttribute('animation', 'property: material.opacity; from: 1.0; to: 0.0 dur: 500; dir: alternate;');
            player.appendChild(blocker);

            /* Timer*/
            setTimeout(function () {
              let fadeBlocker = document.querySelector('#artifact');
              fadeBlocker.remove();;
            }, 2000);
          }
        });

        // CLICK EVENTS
        const onClick = (event) => {
          // Returning artifact
          if(event.srcElement.id == "rightfulPlace"){
            console.log("ARTIFACT RETURNED ");

            // Fade out
            var player = document.getElementById("player");
            let blocker = document.createElement('a-sphere');
            blocker.setAttribute('radius', '0.05');
            blocker.setAttribute('material', "shader:flat; color: white; opacity: 0.0; side: double");
            blocker.setAttribute('id', "artifact");
            blocker.setAttribute('animation', 'property: material.opacity; from: 0.0; to: 1.0 dur: 500; dir: alternate;');
            player.appendChild(blocker);

            // Timer before fade out
            setTimeout(function () {
              window.location.replace("http://localhost:8080/returnJourney.html");
            }, 1500);
          }
        } 
        window.addEventListener('click', onClick);
      </script>

    </head>
    <body>

      <!-- BUTTON EXPERIENCE -->
      <div id="collectedItem" style="position:absolute; bottom:0px; left:1vw; z-index:1000; opacity: 1;">
        <img src="assets/box.png" width="150" height="150">
      </div>

      <!-- A-SCENE -->
      <a-scene precontact-experience environment="preset: forest; shadow: true" physics="driver:ammo;">
     
      <a-assets>
        <a-asset-item id="cornModel" response-type="arraybuffer"  src="/assets/birchTree/scene.gltf"></a-asset-item>
        <a-image src="/assets/glow.png"></a-image>
      </a-assets>

      <!-- rightful place -->
      <a-box id="rightfulPlace" ammo-body="type:kinematic; emitCollisionEvents: true" ammo-shape="type:box" scale="0.5 5 0.5" position="0 0.5 -5" material="color:#654321"></a-box>

      <!-- LongHouse -->
      <a-box id="longHouse" position="-10 3 -5" scale="20 6 4" rotation="0 70 0" color="brown"></a-box>
      <a-box id="longHouse" position="-14 3 21" scale="20 6 4" rotation="0 20 0" color="brown"></a-box>

      <!-- Drying rack  -->
      <a-box id="drying-rack" position="-2.98665 1 -11" scale="2.5 0.1 0.1" rotation="30.0000701530499 -47.761761802105426 -120.0002806121996" color="brown" material="" geometry=""></a-box>
      <a-box id="drying-rack" position="-1.4765 1 -11" scale="2.5 0.1 0.1" rotation="30.0000701530499 -48.814858229555874 -120.0002806121996" color="brown" material="" geometry=""></a-box>
      <a-box id="drying-rack" position="-1.67595 1 -10.10107" scale="2.5 0.1 0.1" rotation="30.0000701530499 130.46191699349333 -120.0002806121996" color="brown" material="" geometry=""></a-box>
      <a-box id="drying-rack" position="-3.02306 1 -10.1059" scale="2.5 0.1 0.1" rotation="30.0000701530499 129.5824267779675 -120.0002806121996" color="brown" material="" geometry=""></a-box>
      <a-box id="drying-rack" position="-2.36162 1.63557 -11.58017" scale="5 0.1 0.1" rotation="28.86504076089574 -179.99182655137244 -0.0469825392007275" color="brown" material="" geometry=""></a-box>

      <!-- Corn crops -->
      <a-box id="dirt" position="7.67522 -0.00668 2.29527" scale="5.21325 0.6372 0.36644" rotation="90 92.14502 -178.3680641599717" color="brown" material="" geometry="primitive: sphere"></a-box>
      <a-box id="dirt" position="8.67522 -0.00668 2.29527" scale="5.21325 0.6372 0.36644" rotation="90 92.14502 -178.3680641599717" color="brown" material="" geometry="primitive: sphere"></a-box>
      <a-box id="dirt" position="9.67522 -0.00668 2.29527" scale="5.21325 0.6372 0.36644" rotation="90 92.14502 -178.3680641599717" color="brown" material="" geometry="primitive: sphere"></a-box>
      
      
      <!-- <a-entity id="birchTree" gltf-model="#cornModel" blessing></a-entity> -->
      <a-box position="1 1 1" blessing></a-box>
      <!-- Set attribute below if above object is clicked -->
      <!-- <a-sphere material="color: yellow; opacity: 0.2; dithering: false; shader: flat; blending: additive; src: assets/glow.png" scale="0.5 10 0.1" position="0 4 -14" ></a-sphere>
       -->


      <!-- Corn Pestel -->

      <a-entity camera id="player" position="0 2 0" wasd-controls look-controls >
        <a-entity cursor id="cameraDot" position="0 0 -1"
                  geometry="primitive: sphere; radius:0.008"
                  material="color:black; shader:flat; opacity:0.5"></a-entity>
      </a-entity>

    </a-scene>
  </body>
</html>